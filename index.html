<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Analizador de Funciones Racionales</title>

  <!-- Chart.js para la gráfica -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- math.js para evaluaciones seguras -->
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.js"></script>

  <style>
    :root{
      --bg:#f4f6fb;
      --card:#ffffff;
      --accent:#2563eb;
      --muted:#6b7280;
      --success:#059669;
      --danger:#ef4444;
    }
    body{
      margin:0;
      font-family:Inter,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:#111827;
      padding:22px;
    }
    .wrap{
      max-width:1000px;
      margin:18px auto;
    }
    .card{
      background:var(--card);
      border-radius:12px;
      box-shadow:0 6px 18px rgba(16,24,40,0.06);
      padding:20px;
      margin-bottom:14px;
    }
    h1{margin:0 0 8px 0;font-size:20px}
    .example{
      background:#eef2ff;border-left:4px solid var(--accent);
      padding:10px;border-radius:8px;margin-bottom:14px;color:#0f172a;
    }
    .input-row{display:flex;gap:10px;align-items:center}
    #functionInput{
      flex:1;padding:12px;border-radius:8px;border:1px solid #e6edf8;font-size:15px;
      outline:none;
    }
    button{
      background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:8px;
      cursor:pointer;font-weight:600;
    }
    button:active{transform:translateY(1px)}
    .guide{background:#f9fafb;border-radius:8px;padding:12px;border:1px solid #eee;margin-top:12px;color:var(--muted)}
    .results{display:grid;grid-template-columns:1fr 380px;gap:14px;margin-top:14px}
    .block{background:#fff;border-radius:10px;padding:12px;border:1px solid #f0f0f0;min-height:80px}
    .small{font-size:13px;color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    td,th{padding:6px 8px;border-bottom:1px dashed #eee;font-size:14px}
    .danger{color:var(--danger)}
    .asymptote{color:#9ca3af;font-size:13px}
    canvas{background:#ffffff;border-radius:8px;padding:6px}
    .note{font-size:13px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Analizador de funciones racionales</h1>
      <div class="example"><strong>Ejemplo:</strong> <span class="small">f(x) = (x^2 - 4) / (x - 2)</span></div>

      <div class="input-row">
        <input id="functionInput" placeholder="Escribe la función como (numerador)/(denominador). Ej: (2*x^2 - 5*x + 3)/(x - 1)" autocomplete="off" />
        <button id="analyzeBtn">Analizar</button>
      </div>

      <div class="guide">
        <strong>Cómo ingresar la función:</strong>
        <ul>
          <li>Usa <code>x</code> como variable.</li>
          <li>Escribe potencias como <code>x^2</code>, <code>x^3</code>.</li>
          <li>Multiplicación explícita: <code>2*x</code>.</li>
          <li>Formato obligatorio: <code>(numerador)/(denominador)</code>.</li>
        </ul>
      </div>
    </div>

    <div class="results">
      <div class="card block" style="min-height:320px;">
        <h3>Resultados</h3>
        <div id="summaryArea" class="small note">Ingresa una función y pulsa <strong>Analizar</strong>.</div>

        <div id="details" style="margin-top:10px;display:none">
          <p><strong>Simplificación:</strong> <span id="simplified"></span></p>
          <p><strong>Dominio:</strong> <span id="domain"></span></p>
          <p><strong>Asíntotas verticales:</strong> <span id="vertAsym"></span></p>
          <p><strong>Asíntota horizontal / oblicua:</strong> <span id="horizAsym"></span></p>
          <p><strong>Huecos:</strong> <span id="holes"></span></p>

          <div style="margin-top:10px;">
            <strong>Tabla de valores:</strong>
            <div id="tableWrap" style="margin-top:6px"></div>
          </div>
        </div>
      </div>

      <div class="card block">
        <h3>Gráfica</h3>
        <canvas id="chart" height="300"></canvas>
        <div id="chartNote" class="note">La gráfica evita puntos no definidos.</div>
      </div>
    </div>
  </div>

<script>
(() => {

  const $ = id => document.getElementById(id);
  const math = window.math;

  function splitFraction(input) {
    let s = input.trim().replace(/^\s*f\s*\(\s*x\s*\)\s*=\s*/i, '');
    let depth = 0;
    for (let i=0;i<s.length;i++){
      if (s[i]==='(') depth++;
      if (s[i]===')') depth--;
      if (s[i]==='/' && depth===0){
        return [s.slice(0,i).trim(), s.slice(i+1).trim()];
      }
    }
    return null;
  }

  function normalizeExpr(str){
    return str.replace(/\^/g, '**').replace(/\s+/g,'');
  }

  function parsePolynomial(polyStr) {
    let s = polyStr.trim();
    if (s.startsWith('(') && s.endsWith(')')) s = s.slice(1,-1);
    s = s.replace(/\s+/g,'');
    s = s.replace(/^\-/,'~');
    s = s.replace(/\+/g,'+');
    s = s.replace(/\-/g,'+-');
    s = s.replace(/~/,'-');
    const terms = s.split('+').filter(Boolean);
    let coeffs = {};

    for (let t of terms) {
      let coef = 1, pow = 0;
      if (t.includes('x')) {
        const parts = t.split('x');
        let cpart = parts[0];
        if (cpart === '' || cpart === '+') coef = 1;
        else if (cpart === '-') coef = -1;
        else {
          cpart = cpart.replace(/\*$/,'');
          coef = parseFloat(cpart);
        }
        pow = parts[1] && parts[1].match(/\^(\d+)/) ? parseInt(RegExp.$1) : (parts[1] ? 1 : 1);
      } else {
        coef = parseFloat(t);
      }
      coeffs[pow] = (coeffs[pow] || 0) + coef;
    }

    const maxPow = Math.max(...Object.keys(coeffs).map(k=>parseInt(k)));
    const arr = new Array(maxPow+1).fill(0);
    for (let k in coeffs) arr[parseInt(k)] = coeffs[k];

    while (arr.length>1 && Math.abs(arr[arr.length-1])<1e-12) arr.pop();
    return arr;
  }

  function evalPoly(coeffs, x) {
    let y = 0;
    for (let i=coeffs.length-1;i>=0;i--) y = y * x + coeffs[i];
    return y;
  }

  function degree(c){ return c.length-1; }

  function polyDiv(num, den) {
    let a = num.slice(), b = den.slice();
    let n = a.length-1, m = b.length-1;
    if (n < m) return {quotient:[0], remainder:a};
    let q = new Array(n-m+1).fill(0);
    for (let k=n-m; k>=0; k--){
      const coeff = a[m+k]/b[m];
      q[k] = coeff;
      for (let j=0;j<=m;j++) a[j+k] -= coeff*b[j];
    }
    while (a.length>0 && Math.abs(a[a.length-1])<1e-10) a.pop();
    if (a.length===0) a=[0];
    while (q.length>1 && Math.abs(q[q.length-1])<1e-12) q.pop();
    return {quotient:q, remainder:a};
  }

  function findRealRoots(coeffs, opts={tol:1e-7, maxIter:50, scanStep:0.5, range:50}) {
    const f=x=>evalPoly(coeffs,x);
    const roots=[];
    const step=opts.scanStep;
    for(let x=-opts.range; x<=opts.range; x+=step){
      const a=x, b=x+step;
      const fa=f(a), fb=f(b);
      if (fa===0) roots.push(a);
      else if (fa*fb<0){
        let lo=a, hi=b;
        for(let i=0;i<opts.maxIter;i++){
          const mid=(lo+hi)/2, fm=f(mid);
          if (Math.abs(fm)<opts.tol){ lo=hi=mid; break; }
          if (fa*fm<=0) hi=mid; else lo=mid;
        }
        const r=(lo+hi)/2;
        if(!roots.some(v=>Math.abs(v-r)<1e-4)) roots.push(r);
      }
    }
    return roots.sort((a,b)=>a-b);
  }

  function syntheticDivide(coeffs, r) {
    let n=coeffs.length-1;
    const out=new Array(n).fill(0);
    out[n-1]=coeffs[n];
    for(let i=n-2;i>=0;i--) out[i]=coeffs[i+1]+r*out[i+1];
    const rem=coeffs[0]+r*out[0];
    return {quot:out, rem:rem};
  }

  function polyToString(c) {
    let p=[];
    for(let i=c.length-1;i>=0;i--){
      const a=c[i];
      if (Math.abs(a)<1e-12) continue;
      const sign=a<0?"-":(p.length===0?"":"+");
      const m=Math.abs(a);
      if (i===0) p.push(`${sign}${m}`);
      else if (i===1) p.push(`${sign}${(m===1?"":m+"*")}x`);
      else p.push(`${sign}${(m===1?"":m+"*")}x^${i}`);
    }
    return p.join(" ").replace(/\+\-/g,"- ");
  }

  let chart=null;
  function drawChart(xs, ys) {
    if(chart) chart.destroy();
    chart=new Chart($("chart"),{
      type:"line",
      data:{
        labels:xs,
        datasets:[{
          data:ys,
          borderWidth:2,
          fill:false,
          pointRadius:0
        }]
      },
      options:{
        animation:false,
        scales:{x:{},y:{}},
        plugins:{legend:{display:false}}
      }
    });
  }

  function formatNumber(n){
    if(n===null||n===undefined) return "undefined";
    if(Math.abs(n)<1e-8) return "0";
    if(Math.abs(n-Math.round(n))<1e-8) return String(Math.round(n));
    return Number.parseFloat(n.toFixed(6)).toString();
  }

  function analyze(str){
    $("summaryArea").textContent="Analizando...";
    $("details").style.display="none";

    const frac=splitFraction(str);
    if(!frac){
      $("summaryArea").innerHTML='<span class="danger">Error:</span> Usa (numerador)/(denominador).';
      return;
    }

    const [numStr, denStr]=frac;
    const num=parsePolynomial(numStr);
    const den=parsePolynomial(denStr);
    if(!num||!den){
      $("summaryArea").innerHTML='<span class="danger">Error:</span> Polinomios inválidos.';
      return;
    }

    const denRoots=findRealRoots(den);
    const numRoots=findRealRoots(num);

    let holes=[], asym=[];
    for(let r of denRoots){
      if(Math.abs(evalPoly(num,r))<1e-6) holes.push(r);
      else asym.push(r);
    }

    let sNum=num.slice(), sDen=den.slice();
    for(let r of holes){
      const d1=syntheticDivide(sNum,r), d2=syntheticDivide(sDen,r);
      if(Math.abs(d1.rem)<1e-6 && Math.abs(d2.rem)<1e-6){
        sNum=d1.quot; sDen=d2.quot;
      }
    }

    let hAsym="Ninguna", degNum=degree(num), degDen=degree(den);
    if(degNum<degDen) hAsym="y = 0";
    else if(degNum===degDen){
      const y0=num[num.length-1]/den[den.length-1];
      hAsym="y = "+formatNumber(y0);
    } else if(degNum===degDen+1){
      const div=polyDiv(num,den);
      const q=div.quotient, m=q[1]||0, b=q[0]||0;
      hAsym=`y = ${formatNumber(m)}x + ${formatNumber(b)}`;
    } else {
      hAsym="División polinómica necesaria";
    }

    let simplified = (polyToString(sNum)+"/"+polyToString(sDen));

    let dom="Todos los reales";
    if(denRoots.length>0){
      dom="ℝ \\ { "+denRoots.map(r=>formatNumber(r)).join(", ")+" }";
    }

    let xs=[], ys=[];
    for(let x=-10; x<=10; x+=0.25){
      if(denRoots.some(r=>Math.abs(x-r)<1e-6)) {xs.push(x); ys.push(null); continue;}
      xs.push(x);
      ys.push(evalPoly(num,x)/evalPoly(den,x));
    }

    drawChart(xs,ys);

    $("summaryArea").textContent="Análisis completo:";
    $("details").style.display="block";
    $("simplified").textContent = simplified;
    $("domain").textContent = dom;
    $("vertAsym").textContent = asym.length? asym.map(formatNumber).join(", ") : "Ninguna";
    $("horizAsym").textContent = hAsym;
    $("holes").textContent = holes.length? holes.map(formatNumber).join(", ") : "Ninguno";

    let html="<table><tr><th>x</th><th>f(x)</th></tr>";
    for(let i=0;i<xs.length;i+=8){
      html+=`<tr><td>${formatNumber(xs[i])}</td><td>${ys[i]===null?"Indef." : formatNumber(ys[i])}</td></tr>`;
    }
    html+="</table>";
    $("tableWrap").innerHTML=html;
  }

  $("analyzeBtn").onclick=()=>{
    analyze($("functionInput").value);
  };

})();
</script>

</body>
</html>
