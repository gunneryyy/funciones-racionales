<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Funciones Racionales</title>
<script src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0/lib/browser/math.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #f4f4f4;
}
#contenedor {
  max-width: 900px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 10px;
}
input, button {
  padding: 10px;
  font-size: 16px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}
td, th {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}
canvas {
  margin-top: 20px;
}
.subtitulo {
  font-weight: bold;
  margin-top: 20px;
}
</style>
</head>

<body>
<div id="contenedor">
<h2>Funciones Racionales</h2>

<input id="funcion" placeholder="Ingresa una función. Ej: (x^2-4)/(x-2)" style="width:70%">
<button onclick="procesar()">Resolver</button>

<div id="info"></div>
<canvas id="grafica" height="350"></canvas>
<div id="tabla"></div>

</div>

<script>
function red2(n){
  return Math.round(n * 100) / 100;
}

function procesar(){
  const expr = document.getElementById("funcion").value;
  if(!expr){ return; }

  let f = x => {
    try{
      return math.evaluate(expr, {x:x});
    }catch{ return NaN; }
  };

  let puntosX = [];
  let puntosY = [];
  let limites = {xmin: -10, xmax: 10};

  for(let x=-10; x<=10; x+=0.1){
    const y = f(x);
    if(!isNaN(y) && isFinite(y)){
      puntosX.push(x);
      puntosY.push(y);
    }
  }

  if(puntosY.length > 0){
    let minY = Math.min(...puntosY);
    let maxY = Math.max(...puntosY);
    limites.ymin = minY;
    limites.ymax = maxY;
  } else {
    limites.ymin = -10;
    limites.ymax = 10;
  }

  let xvals = [];
  let step = 20;
  for(let v=limites.xmin; v<=limites.xmax; v+=step){
    xvals.push(red2(v));
  }

  let tablaHTML = "<h3 class='subtitulo'>Tabla de Valores</h3>";
  tablaHTML += "<table><tr><th>x</th><th>f(x)</th></tr>";

  xvals.forEach(x=>{
    let y = f(x);
    tablaHTML += `<tr><td>${x}</td><td>${isFinite(y) ? red2(y) : "—"}</td></tr>`;
  });

  tablaHTML += "</table>";
  document.getElementById("tabla").innerHTML = tablaHTML;

  const ctx = document.getElementById("grafica").getContext("2d");
  if(window.miGrafica){ window.miGrafica.destroy(); }

  window.miGrafica = new Chart(ctx,{
    type:"line",
    data:{
      labels:puntosX.map(x=>red2(x)),
      datasets:[{
        data:puntosY,
        borderWidth:2,
        fill:false,
        pointRadius:0
      }]
    },
    options:{
      responsive:true,
      scales:{
        x:{min:limites.xmin, max:limites.xmax},
        y:{min:limites.ymin, max:limites.ymax}
      }
    }
  });

  let rangoInfo = "";
  if(isFinite(limites.ymin) && isFinite(limites.ymax)){
    rangoInfo = `<h3 class='subtitulo'>Rango Aproximado</h3>
                 <div>≈ [ ${red2(limites.ymin)} , ${red2(limites.ymax)} ]</div>`;
  }

  document.getElementById("info").innerHTML = rangoInfo;
}

</script>
</body>
</html>
